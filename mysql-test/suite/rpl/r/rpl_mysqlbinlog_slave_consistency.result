include/master-slave.inc
[connection master]
connection slave;
include/stop_slave.inc
connection master;
RESET MASTER;
connection slave;
include/start_slave.inc
#
#
#  Test Case 1: Base case to ensure that mariadb-binlog and replica
#  are consistent without any filtering
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos;
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t5 is equivalent on master and slave
connection master;
connection slave;
# t4 is equivalent on master and slave
connection master;
connection slave;
# t3 is equivalent on master and slave
connection master;
connection slave;
# t2 is equivalent on master and slave
connection master;
connection slave;
# t1 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 2: Ensure filtering by a single id in --do-domain-ids is
#  consistent between mariadb-binlog and replica
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, DO_DOMAIN_IDS=(0);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --do-domain-ids=0 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t2 is equivalent on master and slave
connection master;
connection slave;
# t1 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 3: Ensure filtering by multiple ids in --do-domain-ids is
#  consistent between mariadb-binlog and replica
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, DO_DOMAIN_IDS=(0,1);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --do-domain-ids=0,1 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t4 is equivalent on master and slave
connection master;
connection slave;
# t3 is equivalent on master and slave
connection master;
connection slave;
# t2 is equivalent on master and slave
connection master;
connection slave;
# t1 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#  Test Case 4: Ensure filtering by a single id in --ignore-domain-ids
#  is consistent between mariadb-binlog and replica
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_DOMAIN_IDS=(0);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-domain-ids=0 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t5 is equivalent on master and slave
connection master;
connection slave;
# t4 is equivalent on master and slave
connection master;
connection slave;
# t3 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t2'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 5: Ensure filtering by multiple ids in --ignore-domain-ids
#  is consistent between mariadb-binlog and replica
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_DOMAIN_IDS=(0,1);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-domain-ids=0,1 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t5 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t2,test.t3,test.t4'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#  Test Case 6: Ensure filtering by a single id in --ignore-server-ids
#  is consistent between mariadb-binlog and replica
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_SERVER_IDS=(1);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-server-ids=1 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t4 is equivalent on master and slave
connection master;
connection slave;
# t2 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t3,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 7: Ensure filtering by multiple ids in --ignore-server-ids
#  is consistent between mariadb-binlog and replica
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_SERVER_IDS=(0,1);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-server-ids=0,1 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t4 is equivalent on master and slave
connection master;
connection slave;
# t2 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t3,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 8: Ensure stop position consistency
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos;
START SLAVE UNTIL master_gtid_pos="1-1-2";
# Because there is a stop position we wait for all events to process
# and slave to automatically stop
# Stop slave so it stops receiving master events.
Warnings:
Note	1255	Slave already has been stopped
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --stop-position=1-1-2 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t3 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t2,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 9: Ensure start position consistency
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
set global gtid_slave_pos="1-4-2";
CHANGE MASTER TO MASTER_USE_GTID=slave_pos;
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t5 is equivalent on master and slave
connection master;
connection slave;
# t4 is equivalent on master and slave
connection master;
connection slave;
# t2 is equivalent on master and slave
connection master;
connection slave;
# t1 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t3'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 10: Ensure consistency when filtering by both
#  --do-domain-ids and --ignore-server-ids
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, DO_DOMAIN_IDS=(0), IGNORE_SERVER_IDS=(1);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --do-domain-ids=0 --ignore-server-ids=1 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t2 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 11: Ensure consistency when filtering by both
#  --ignore-domain-ids and --ignore-server-ids
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_DOMAIN_IDS=(1,2), IGNORE_SERVER_IDS=(1);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-domain-ids=1,2 --ignore-server-ids=1 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t2 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 12: Ensure consistency when filtering by
#  --do-domain-ids with a stop position
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, DO_DOMAIN_IDS=(0);
START SLAVE UNTIL master_gtid_pos="0-1-4";
# Because there is a stop position we wait for all events to process
# and slave to automatically stop
# Stop slave so it stops receiving master events.
Warnings:
Note	1255	Slave already has been stopped
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --do-domain-ids=0 --stop-position=0-1-4 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t2 is equivalent on master and slave
connection master;
connection slave;
# t1 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 13: Ensure consistency when filtering by
#  --ignore-domain-ids with a stop position
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_DOMAIN_IDS=(0);
START SLAVE UNTIL master_gtid_pos="0-1-4";
# Because there is a stop position we wait for all events to process
# and slave to automatically stop
# Stop slave so it stops receiving master events.
Warnings:
Note	1255	Slave already has been stopped
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-domain-ids=0 --stop-position=0-1-4 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
connection master;
# Both servers have 0 tables
# Verifying integrity of tables..
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t2,test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 14: Ensure consistency when filtering by
#  --ignore-server-ids with a stop position
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_SERVER_IDS=(3);
START SLAVE UNTIL master_gtid_pos="0-1-4";
# Because there is a stop position we wait for all events to process
# and slave to automatically stop
# Stop slave so it stops receiving master events.
Warnings:
Note	1255	Slave already has been stopped
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-server-ids=3 --stop-position=0-1-4 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t1 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t2,test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 15: Ensure consistency when filtering by
#  --do-domain-ids with a start position
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
set global gtid_slave_pos="1-1-2";
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, DO_DOMAIN_IDS=(2);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --do-domain-ids=2 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t5 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t2,test.t3,test.t4'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 16: Ensure consistency when filtering by
#  --ignore-domain-ids with a start position
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
set global gtid_slave_pos="0-1-1";
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_DOMAIN_IDS=(0);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-domain-ids=0 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t5 is equivalent on master and slave
connection master;
connection slave;
# t4 is equivalent on master and slave
connection master;
connection slave;
# t3 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t2'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 17: Ensure consistency when filtering by
#  --ignore-server-ids with a start position
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
set global gtid_slave_pos="0-1-1";
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_SERVER_IDS=(1);
START SLAVE ;
# Wait for slave to catch up to master
# Wait for slave IO thread to catch up
# Wait for slave SQL thread to catch up
# Stop slave so it stops receiving master events.
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-server-ids=1 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t4 is equivalent on master and slave
connection master;
connection slave;
# t2 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t3,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 18: Ensure consistency when filtering by
#  --do-domain-ids with both a start position and stop position that
# all have the same domain id
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
set global gtid_slave_pos="0-1-1";
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, DO_DOMAIN_IDS=(0);
START SLAVE UNTIL master_gtid_pos="0-3-3";
# Because there is a stop position we wait for all events to process
# and slave to automatically stop
# Stop slave so it stops receiving master events.
Warnings:
Note	1255	Slave already has been stopped
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --do-domain-ids=0 --stop-position=0-3-3 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t2 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 19: Ensure consistency when filtering by
#  --do-domain-ids with both a start position and stop position that
#  have differing domain ids. Due to the implicit filtering in stop
#  position, the result should be empty (no tables replicated).
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
set global gtid_slave_pos="0-1-1";
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, DO_DOMAIN_IDS=(1);
START SLAVE UNTIL master_gtid_pos="0-3-3";
# Because there is a stop position we wait for all events to process
# and slave to automatically stop
# Stop slave so it stops receiving master events.
Warnings:
Note	1255	Slave already has been stopped
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --do-domain-ids=1 --stop-position=0-3-3 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
connection master;
# Both servers have 0 tables
# Verifying integrity of tables..
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t2,test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 20: Ensure consistency when filtering by
#  --ignore-domain-ids with both a start position and stop position that
#  all have the same domain id. The result set should be empty due to
#  implicit filtering from stop position and ignoring that same domain.
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
set global gtid_slave_pos="0-1-1";
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_DOMAIN_IDS=(0);
START SLAVE UNTIL master_gtid_pos="0-3-3";
# Because there is a stop position we wait for all events to process
# and slave to automatically stop
# Stop slave so it stops receiving master events.
Warnings:
Note	1255	Slave already has been stopped
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-domain-ids=0 --stop-position=0-3-3 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
connection master;
# Both servers have 0 tables
# Verifying integrity of tables..
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t2,test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 21: Ensure consistency when filtering by
#  --ignore-domain-ids with both a start position and stop position that
#  have differing domain ids. The ignore domain ids should take no
#  effect due to the implicit filtering by stop position, i.e. the
#  specified domain to ignore is already being filtered.
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
set global gtid_slave_pos="0-1-1";
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_DOMAIN_IDS=(1);
START SLAVE UNTIL master_gtid_pos="0-3-3";
# Because there is a stop position we wait for all events to process
# and slave to automatically stop
# Stop slave so it stops receiving master events.
Warnings:
Note	1255	Slave already has been stopped
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-domain-ids=1 --stop-position=0-3-3 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t2 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t1,test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
#
#
#  Test Case 22: Ensure consistency when filtering by
#  --ignore-server-ids with both a start position and stop position.
#
include/mysqlbinlog_slave_consistency.inc
connection slave;
connection master;
# Populating master data
connection slave;
set global gtid_slave_pos="0-1-0";
CHANGE MASTER TO MASTER_USE_GTID=slave_pos, IGNORE_SERVER_IDS=(3);
START SLAVE UNTIL master_gtid_pos="0-3-3";
# Because there is a stop position we wait for all events to process
# and slave to automatically stop
# Stop slave so it stops receiving master events.
Warnings:
Note	1255	Slave already has been stopped
# Use mysqlbinlog to update master with the same parameters as slave
connection master;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
RESET MASTER;
# MYSQL_BINLOG BINLOG_FILE_PARAM  --ignore-server-ids=3 --stop-position=0-3-3 | MYSQL
connection slave;
# Checking consistency of 'test' database tables between master and slave
# Verifying integrity of tables..
connection master;
connection slave;
# t1 is equivalent on master and slave
# All tables are consistent
# Test finished - resetting master and slave..
connection slave;
Warnings:
Note	1255	Slave already has been stopped
RESET SLAVE;
set global gtid_slave_pos="";
CHANGE MASTER TO DO_DOMAIN_IDS=(), IGNORE_DOMAIN_IDS=(), IGNORE_SERVER_IDS=();
connection master;
RESET MASTER;
DROP TABLE IF EXISTS t1, t2, t3, t4, t5;
Warnings:
Note	1051	Unknown table 'test.t2,test.t3,test.t4,test.t5'
connection slave;
RESET SLAVE;
set global gtid_slave_pos="";
RESET MASTER;
connection master;
RESET MASTER;
connection slave;
connection master;
connection master;
RESET MASTER;
include/rpl_end.inc
# End of tests (rpl.rpl_mysqlbinlog_slave_consistency)
